---
// ImageSlider.astro
import Image from "astro/components/Image.astro";
const images = [
  { src: "/SliderImages/1.webp", alt: "monopole", title: "Monopole Erection" },
  { src: "/SliderImages/2.webp", alt: "Special Cage", title: "Special Cage Construction" },
  { src: "/SliderImages/3.webp", alt: "Pile Foundation", title: "Pile Foundation" },
  // { src: "/SliderImages/4.webp", alt: "Waterfall", title: "Pile Chipping" },
  // { src: "/SliderImages/5.webp", alt: "Waterfall", title: "Piling Job With Hydraulic Rig Machine" },
  // { src: "/SliderImages/6.webp", alt: "Monopole Transmission", title: "66 kV Monopole Transmission" },
];
---

<div class="relative w-full overflow-hidden" id="image-slider">
  <div class="flex transition-transform duration-500 ease-in-out" id="slider-container">
    {images.map((image, index) => (
      <div class="flex-shrink-0 w-full">
        <div class="relative">
          <Image
            src={image.src}
            alt={image.alt}
            width="100"
            height="100"
            class="w-full h-128  object-cover shadow-lg"
          />
          <div class="absolute inset-0 flex items-center   bg-black bg-opacity-40">
            <h2 class="ml-10 text-white text-xl lg:text-5xl font-bold text-center">
              <div class="absolute top-[30%] text-primary font-semibold">Dwizzy Infra </div>
              <div class="absolute top-[42%] font-semibold">We Do Easy</div>
              <div class="absolute top-[55%]">{image.title}</div>
              </h2>
          </div>
        </div>
      </div>
    ))}
  </div>

  <div class="absolute inset-x-0 bottom-0 h-1 bg-gray-300">
    <div class="h-full bg-blue-500 transition-all duration-500 ease-in-out" id="progress-bar"></div>
  </div>

  <div class="absolute inset-y-0 left-0 flex items-center">
    <button id="prev-button" class="bg-white/50 p-2 rounded-r-full shadow-md hover:bg-white/75 transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
  </div>

  <div class="absolute inset-y-0 right-0 flex items-center">
    <button id="next-button" class="bg-white/50 p-2 rounded-l-full shadow-md hover:bg-white/75 transition-colors">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  const sliderContainer = document.getElementById('slider-container');
  const prevButton = document.getElementById('prev-button');
  const nextButton = document.getElementById('next-button');
  const progressBar = document.getElementById('progress-bar');
  const imageCount = document.querySelectorAll('#slider-container > div').length;
  let currentIndex = 0;
  let autoSlideInterval: number | any;

  function updateSlider() {
    if (sliderContainer) {
      sliderContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
    }
    if (progressBar) {
      progressBar.style.width = `${((currentIndex + 1) / imageCount) * 100}%`;
    }
  }

  function slideImage(direction: number) {
    currentIndex = (currentIndex + direction + imageCount) % imageCount;
    updateSlider();
    resetAutoSlide();
  }

  function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
      slideImage(1);
    }, 5000); // Change slide every 5 seconds
  }

  function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    startAutoSlide();
  }

  if (prevButton) {
    prevButton.addEventListener('click', () => slideImage(-1));
  }
  if (nextButton) {
    nextButton.addEventListener('click', () => slideImage(1));
  }

  // Initialize the slider and start auto-sliding
  updateSlider();
  startAutoSlide();

  // Optional: Pause auto-sliding when hovering over the slider
  const imageSlider = document.getElementById('image-slider');
  if (imageSlider) {
    imageSlider.addEventListener('mouseenter', () => clearInterval(autoSlideInterval));
    imageSlider.addEventListener('mouseleave', startAutoSlide);
  }
</script>